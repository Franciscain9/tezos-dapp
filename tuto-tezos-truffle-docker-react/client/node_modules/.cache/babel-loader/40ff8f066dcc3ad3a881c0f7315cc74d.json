{"ast":null,"code":"var _jsxFileName = \"/Users/anaischokote/franciscain/tezos-react-tutorial/client/src/App.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { Tezos } from \"@taquito/taquito\";\nimport { TezBridgeSigner } from \"@taquito/tezbridge-signer\";\nimport Menu from \"./Menu\";\nimport \"./App.css\";\nimport \"./bulma.css\";\n/* PUT HERE THE CONTRACT ADDRESS FOR YOUR OWN SANDBOX! */\n\nconst contractAddress = \"KT1VMnVaD6C87DVxVV2bqAim6w3SjSYBQrhn\";\n\nconst shortenAddress = addr => addr.slice(0, 6) + \"...\" + addr.slice(addr.length - 6);\n\nconst mutezToTez = mutez => Math.round((parseInt(mutez) / 1000000 + Number.EPSILON) * 100) / 100;\n\nconst App = () => {\n  const [contractInstance, setContractInstance] = useState(undefined);\n  const [coffeeMenu, setCoffeeMenu] = useState([]);\n  const [userAddress, setUserAddress] = useState(undefined);\n  const [balance, setBalance] = useState(undefined);\n  const [userPoints, setUserPoints] = useState(undefined);\n  const [isOwner, setIsOwner] = useState(false);\n  const [contractBalance, setContractBalance] = useState(0);\n  const tezbridge = window.tezbridge;\n\n  const initWallet = async () => {\n    try {\n      // sets rpc host\n\n      /*const rpc = await tezbridge.request({\n        method: \"set_host\",\n        host: \"http://localhost:8732\"\n      });*/\n      // gets user's address\n      const _address = await tezbridge.request({\n        method: \"get_source\"\n      });\n\n      setUserAddress(_address); // gets user's balance\n\n      const _balance = await Tezos.tz.getBalance(_address);\n\n      setBalance(_balance); // gets user's points\n\n      const storage = await contractInstance.storage();\n      const points = storage.customers.get(_address);\n      setUserPoints(parseInt(points)); // compares user's address with owner's address\n\n      if (storage.owner === _address) {\n        setIsOwner(true);\n\n        const _contractBalance = await Tezos.tz.getBalance(contractAddress);\n\n        setContractBalance(_contractBalance.c[0]);\n      }\n    } catch (error) {\n      console.log(\"error fetching the address or balance:\", error);\n    }\n  };\n\n  const withdraw = async () => {\n    // sends withdrawal request\n    const op = await contractInstance.methods.withdraw([[\"unit\"]]).send(); // waits for confirmation\n\n    await op.confirmation(1); // if confirmed\n\n    if (op.includedInBlock !== Infinity) {\n      const newBalance = await Tezos.tz.getBalance(userAddress);\n      setBalance(newBalance);\n    } else {\n      console.log(\"error\");\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // sets RPC\n      Tezos.setProvider({\n        rpc: \"http://localhost:8732\",\n        signer: new TezBridgeSigner()\n      }); // fetches contract storage\n\n      const contract = await Tezos.contract.at(contractAddress);\n      setContractInstance(contract);\n      const storage = await contract.storage(); // creates coffee menu\n\n      let coffees = [];\n\n      for (let key of storage.menu.keys()) {\n        coffees.push({\n          name: key,\n          price: storage.menu.get(key).c[0]\n        });\n      } // updates state\n\n\n      setCoffeeMenu(coffees);\n    })();\n  }, []);\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"wallet\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, balance === undefined ? React.createElement(\"button\", {\n    className: \"button is-info is-light is-small\",\n    onClick: initWallet,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, \"Connect your wallet\") : React.createElement(React.Fragment, null, React.createElement(\"span\", {\n    className: \"balance\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, \"\\uA729 \", balance.toNumber() / 1000000), React.createElement(\"div\", {\n    className: \"field is-grouped\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    className: \"control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"button is-success is-light is-small\",\n    onClick: async () => {\n      setUserAddress(undefined);\n      setBalance(undefined);\n      setUserPoints(undefined);\n      setIsOwner(undefined);\n      await initWallet();\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, shortenAddress(userAddress))), isOwner && React.createElement(\"p\", {\n    className: \"control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"button is-warning is-light is-small\",\n    onClick: withdraw,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, \"Withdraw \\uA729 \", mutezToTez(contractBalance)))))), React.createElement(\"div\", {\n    className: \"app-title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132\n    },\n    __self: this\n  }, \"Caf\\xE9 Tezos\"), React.createElement(\"div\", {\n    className: \"logo\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: \"coffee-maker.png\",\n    alt: \"logo\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  })), coffeeMenu.length === 0 ? \"Loading the menu...\" : React.createElement(Menu, {\n    coffeeMenu: coffeeMenu,\n    contractInstance: contractInstance,\n    userAddress: userAddress,\n    setBalance: setBalance,\n    Tezos: Tezos,\n    userPoints: userPoints,\n    setUserPoints: setUserPoints,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }));\n};\n\nexport default App;","map":{"version":3,"sources":["/Users/anaischokote/franciscain/tezos-react-tutorial/client/src/App.js"],"names":["React","useState","useEffect","Tezos","TezBridgeSigner","Menu","contractAddress","shortenAddress","addr","slice","length","mutezToTez","mutez","Math","round","parseInt","Number","EPSILON","App","contractInstance","setContractInstance","undefined","coffeeMenu","setCoffeeMenu","userAddress","setUserAddress","balance","setBalance","userPoints","setUserPoints","isOwner","setIsOwner","contractBalance","setContractBalance","tezbridge","window","initWallet","_address","request","method","_balance","tz","getBalance","storage","points","customers","get","owner","_contractBalance","c","error","console","log","withdraw","op","methods","send","confirmation","includedInBlock","Infinity","newBalance","setProvider","rpc","signer","contract","at","coffees","key","menu","keys","push","name","price","toNumber"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Tezos } from \"@taquito/taquito\";\nimport { TezBridgeSigner } from \"@taquito/tezbridge-signer\";\nimport Menu from \"./Menu\";\nimport \"./App.css\";\nimport \"./bulma.css\";\n\n/* PUT HERE THE CONTRACT ADDRESS FOR YOUR OWN SANDBOX! */\nconst contractAddress = \"KT1VMnVaD6C87DVxVV2bqAim6w3SjSYBQrhn\";\n\nconst shortenAddress = addr =>\n  addr.slice(0, 6) + \"...\" + addr.slice(addr.length - 6);\n\nconst mutezToTez = mutez =>\n  Math.round((parseInt(mutez) / 1000000 + Number.EPSILON) * 100) / 100;\n\nconst App = () => {\n  const [contractInstance, setContractInstance] = useState(undefined);\n  const [coffeeMenu, setCoffeeMenu] = useState([]);\n  const [userAddress, setUserAddress] = useState(undefined);\n  const [balance, setBalance] = useState(undefined);\n  const [userPoints, setUserPoints] = useState(undefined);\n  const [isOwner, setIsOwner] = useState(false);\n  const [contractBalance, setContractBalance] = useState(0);\n  const tezbridge = window.tezbridge;\n\n  const initWallet = async () => {\n    try {\n      // sets rpc host\n      /*const rpc = await tezbridge.request({\n        method: \"set_host\",\n        host: \"http://localhost:8732\"\n      });*/\n      // gets user's address\n      const _address = await tezbridge.request({ method: \"get_source\" });\n      setUserAddress(_address);\n      // gets user's balance\n      const _balance = await Tezos.tz.getBalance(_address);\n      setBalance(_balance);\n      // gets user's points\n      const storage = await contractInstance.storage();\n      const points = storage.customers.get(_address);\n      setUserPoints(parseInt(points));\n      // compares user's address with owner's address\n      if (storage.owner === _address) {\n        setIsOwner(true);\n        const _contractBalance = await Tezos.tz.getBalance(contractAddress);\n        setContractBalance(_contractBalance.c[0]);\n      }\n    } catch (error) {\n      console.log(\"error fetching the address or balance:\", error);\n    }\n  };\n\n  const withdraw = async () => {\n    // sends withdrawal request\n    const op = await contractInstance.methods.withdraw([[\"unit\"]]).send();\n    // waits for confirmation\n    await op.confirmation(1);\n    // if confirmed\n    if (op.includedInBlock !== Infinity) {\n      const newBalance = await Tezos.tz.getBalance(userAddress);\n      setBalance(newBalance);\n    } else {\n      console.log(\"error\");\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      // sets RPC\n      Tezos.setProvider({\n        rpc: \"http://localhost:8732\",\n        signer: new TezBridgeSigner()\n      });\n      // fetches contract storage\n      const contract = await Tezos.contract.at(contractAddress);\n      setContractInstance(contract);\n      const storage = await contract.storage();\n      // creates coffee menu\n      let coffees = [];\n      for (let key of storage.menu.keys()) {\n        coffees.push({ name: key, price: storage.menu.get(key).c[0] });\n      }\n      // updates state\n      setCoffeeMenu(coffees);\n    })();\n  }, []);\n\n  return (\n    <div className=\"App\">\n      <div className=\"wallet\">\n        {balance === undefined ? (\n          <button\n            className=\"button is-info is-light is-small\"\n            onClick={initWallet}\n          >\n            Connect your wallet\n          </button>\n        ) : (\n          <>\n            <span className=\"balance\">ꜩ {balance.toNumber() / 1000000}</span>\n            <div className=\"field is-grouped\">\n              <p className=\"control\">\n                <button\n                  className=\"button is-success is-light is-small\"\n                  onClick={async () => {\n                    setUserAddress(undefined);\n                    setBalance(undefined);\n                    setUserPoints(undefined);\n                    setIsOwner(undefined);\n                    await initWallet();\n                  }}\n                >\n                  {shortenAddress(userAddress)}\n                </button>\n              </p>\n              {isOwner && (\n                <p className=\"control\">\n                  <button\n                    className=\"button is-warning is-light is-small\"\n                    onClick={withdraw}\n                  >\n                    Withdraw ꜩ {mutezToTez(contractBalance)}\n                  </button>\n                </p>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n      <div className=\"app-title\">Café Tezos</div>\n      <div className=\"logo\">\n        <img src=\"coffee-maker.png\" alt=\"logo\" />\n      </div>\n      {coffeeMenu.length === 0 ? (\n        \"Loading the menu...\"\n      ) : (\n        <Menu\n          coffeeMenu={coffeeMenu}\n          contractInstance={contractInstance}\n          userAddress={userAddress}\n          setBalance={setBalance}\n          Tezos={Tezos}\n          userPoints={userPoints}\n          setUserPoints={setUserPoints}\n        />\n      )}\n      {/*<div>Icons made by <a href=\"https://www.flaticon.com/authors/iconixar\" title=\"iconixar\">iconixar</a> from <a href=\"https://www.flaticon.com/\" title=\"Flaticon\">www.flaticon.com</a><a href=\"https://www.vecteezy.com/free-vector/coffee-cute\">Coffee Cute Vectors by Vecteezy</a></div>*/}\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}